import{createPrompt as e,useState as t,makeTheme as l,usePrefix as n,useEffect as i,useKeypress as r,isEnterKey as s,isSpaceKey as c,isUpKey as a,isDownKey as o,usePagination as m}from"@inquirer/core";import u from"@inquirer/figures";import h from"chalk";const d={Idle:"idle",Done:"done",Canceled:"canceled"},p={prefix:{idle:h.cyan("?"),done:h.green(u.tick),canceled:h.red(u.cross)},style:{active:e=>h.cyan(e),selected:e=>h.green(`${e} ${u.tick}`),unselected:e=>e,cancelText:e=>h.red(e),emptyText:e=>h.red(e),group:e=>h.yellowBright(e),item:e=>e,message:(e,t)=>h.bold(e),help:e=>h.italic.gray(e),answer:e=>h.cyan(e)},hierarchySymbols:{branch:u.lineUpDownRight+u.line,leaf:u.lineUpRight+u.line},help:{top:(e,t)=>`(Press ${u.arrowUp+u.arrowDown} to navigate, ${u.arrowLeft+u.arrowRight} to navigate tree${t?", <space> to toggle selection":""}, <enter> to ${t?"confirm":"select"}${e?", <esc> or q to cancel":""})`,item:e=>e?"(Press <space> to toggle selection)":"(Press <enter> to select)"},renderItem(e,t){const l=t.index===t.items.length-1;let n=l&&!t.loop?this.hierarchySymbols.leaf:this.hierarchySymbols.branch;if(t.isSelected?n+=this.style.selected(e.name):(t.isActive?n+=this.style.active(e.name):t.isSelected?n+=this.style.selected(e.name):e.children?n+=this.style.group(e.name):(l&&t.loop,n+=this.style.unselected(e.name)),n+="  "),t.isActive){const e=this.help.item(t.multiple);n+=` ${this.style.help(e)}`}return n}};function f(e){return"escape"===e.name||"q"===e.name}function g(e){return"pageup"===e.name}function y(u){return e(((e,u)=>{const{pageSize:h=10,loop:y=!1,allowCancel:$=!1,cancelText:v="Canceled.",emptyText:x="No items available.",multiple:w=!1,initialSelection:S,tree:b}=e,[D,T]=t(d.Idle),A=l(p,e.theme),C=n({status:D,theme:A}),[I,k]=t(Array.isArray(S)?S:[S]),[q,P]=t([b]),L=q[q.length-1],[R,U]=t();i((()=>{L.children instanceof Function?(U(void 0),Promise.resolve(L.children()).then((e=>U(e??[])))):process.nextTick((()=>U(L.children??[])))}),[L,L?.children]);const[z,M]=t(0),B=null!=R?R[z]:void 0;r(((e,t)=>{if(s(e))if(w)T(d.Done),u(I);else{if(null==B?.value)return;T(d.Done),u(B.value)}else if(c(e)){if(null==B?.value)return;if(w){const e=I.indexOf(B.value);k(-1!==e?[...I.slice(0,e),...I.slice(e+1)]:[...I,B.value])}else T(d.Done),u(B.value)}else if(function(e){return"right"===e.name}(e))B?.children&&P([...q,B]);else if(function(e){return"left"===e.name}(e)&&q.length>1)P(q.slice(0,-1));else if(f(e)&&$)T(d.Canceled),u(null);else if(a(e)||o(e)||g(e)||function(e){return"pagedown"===e.name}(e)){t.clearLine(0);let l=a(e)?z-1:o(e)?z+1:g(e)?z-h:z+h;l=y?R?.length??0%l:Math.min(Math.max(l,0),(R?.length??0)-1),M(l)}else f(e)&&$&&(T(d.Canceled),u(null))}));const F=m({items:R??[],active:z,renderItem:({item:e,index:t,isActive:l})=>A.renderItem(e,{items:R??[],loop:y,index:t,isActive:l,isSelected:null!=e.value&&I.includes(e.value),multiple:w}),pageSize:h,loop:y}),N=A.style.message(e.message,D);if(D===d.Canceled)return`${C} ${N} ${A.style.cancelText(v)}`;if(B&&D===d.Done){if(w){const e=I.length,t=1===e?"item":"items";return`${C} ${N} ${A.style.answer(`${e} ${t} selected`)}`}return`${C} ${N} ${A.style.answer(B.name)}`}return`${C} ${N} ${A.style.help(A.help.top($,w))}\n${null==R?"Loading...":F.length?F:A.style.emptyText(x)}[?25l`}))(u)}export{d as Status,y as treeSelector};
